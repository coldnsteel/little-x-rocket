<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#8a2be2">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjOGEyYmUyIiByeD0iMjQiLz4KPHN2ZyB4PSI0OCIgeT0iMzIiIHdpZHRoPSI5NiIgaGVpZ2h0PSIxMjgiIHZpZXdCb3g9IjAgMCA2MCA5NiI+CjxyZWN0IHdpZHRoPSI2MCIgaGVpZ2h0PSI5NiIgZmlsbD0iIzhhMmJlMiIgcng9IjMwIi8+CjxjaXJjbGUgY3g9IjMwIiBjeT0iMjQiIHI9IjEyIiBmaWxsPSIjNGI4MmY0Ii8+CjwvU3ZnPgo8L3N2Zz4K">
    
    <title>Little X and the Purple Rocket Ship</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
            position: relative;
            height: 100vh;
        }

        #stars-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .home-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            background: radial-gradient(circle at center, rgba(75, 0, 130, 0.3) 0%, rgba(0, 0, 0, 0.8) 70%);
            transition: opacity 0.8s ease, transform 0.8s ease;
        }

        .rocket {
            width: 120px;
            height: 200px;
            position: relative;
            margin-bottom: 40px;
            animation: bounce 2s ease-in-out infinite, glow 3s ease-in-out infinite alternate;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes glow {
            0% { filter: drop-shadow(0 0 10px #8a2be2); }
            100% { filter: drop-shadow(0 0 30px #8a2be2) drop-shadow(0 0 40px #4b0082); }
        }

        .rocket-body {
            width: 60px;
            height: 120px;
            background: linear-gradient(180deg, #8a2be2 0%, #4b0082 50%, #663399 100%);
            border-radius: 30px 30px 10px 10px;
            position: relative;
            margin: 0 auto;
            box-shadow: inset -5px 0 15px rgba(0,0,0,0.3), inset 5px 0 15px rgba(255,255,255,0.1);
        }

        .rocket-window {
            width: 25px;
            height: 25px;
            background: radial-gradient(circle, #87ceeb 30%, #4169e1 100%);
            border-radius: 50%;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            border: 3px solid #2c1810;
            box-shadow: inset 0 0 10px rgba(255,255,255,0.3);
        }

        .rocket-fins {
            position: absolute;
            bottom: 10px;
            width: 100%;
        }

        .fin {
            width: 0;
            height: 0;
            position: absolute;
            bottom: 0;
        }

        .fin-left {
            border-left: 20px solid transparent;
            border-right: 10px solid #8a2be2;
            border-bottom: 30px solid #8a2be2;
            left: -15px;
        }

        .fin-right {
            border-left: 10px solid #8a2be2;
            border-right: 20px solid transparent;
            border-bottom: 30px solid #8a2be2;
            right: -15px;
        }

        .rocket-flame {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 40px;
            background: radial-gradient(ellipse at center bottom, #ff4500 0%, #ff6347 30%, #ffd700 60%, transparent 100%);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            animation: flicker 0.1s ease-in-out infinite alternate;
        }

        @keyframes flicker {
            0% { 
                transform: translateX(-50%) scaleY(1) scaleX(1);
                opacity: 1;
            }
            100% { 
                transform: translateX(-50%) scaleY(1.1) scaleX(0.9);
                opacity: 0.8;
            }
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #8a2be2, #da70d6, #ff69b4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            0% { text-shadow: 0 0 10px rgba(138, 43, 226, 0.5); }
            100% { text-shadow: 0 0 20px rgba(138, 43, 226, 0.8), 0 0 30px rgba(218, 112, 214, 0.6); }
        }

        .subtitle {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 40px;
            color: #b19cd9;
            opacity: 0.9;
        }

        .start-button {
            background: linear-gradient(45deg, #8a2be2, #4b0082);
            border: none;
            color: white;
            padding: 15px 30px;
            font-size: 1.2rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4); }
            50% { box-shadow: 0 4px 25px rgba(138, 43, 226, 0.6); }
            100% { box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4); }
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(138, 43, 226, 0.6);
        }

        .story-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 20;
            padding: 40px;
            overflow-y: auto;
        }

        .story-content {
            max-width: 600px;
            margin: 0 auto;
            text-align: center;
        }

        .story-text {
            font-size: 1.3rem;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #e6e6fa;
        }

        .choice-button {
            background: linear-gradient(45deg, #4b0082, #8a2be2);
            border: none;
            color: white;
            padding: 12px 25px;
            margin: 10px;
            font-size: 1.1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .choice-button:hover {
            background: linear-gradient(45deg, #8a2be2, #da70d6);
            transform: translateY(-2px);
        }

        .back-button {
            background: linear-gradient(45deg, #333, #666);
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 15px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: linear-gradient(45deg, #666, #999);
        }

        /* Sound Control */
        .sound-control {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(138, 43, 226, 0.8);
            border: none;
            color: white;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .sound-control:hover {
            background: rgba(138, 43, 226, 1);
            transform: scale(1.1);
        }

        /* Install prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(45deg, #8a2be2, #4b0082);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            border: none;
            cursor: pointer;
            display: none;
            z-index: 100;
            animation: bounce 2s infinite;
        }

        @media (max-width: 768px) {
            .title { font-size: 2rem; }
            .subtitle { font-size: 1rem; }
            .start-button { padding: 12px 25px; font-size: 1.1rem; }
            .story-screen { padding: 20px; }
            .story-text { font-size: 1.1rem; }
        }
    </style>
</head>
<body>
    <canvas id="stars-canvas"></canvas>
    
    <!-- Sound Control -->
    <button class="sound-control" id="soundToggle" onclick="toggleSound()">ðŸ”Š</button>
    
    <!-- Install Prompt -->
    <button class="install-prompt" id="installPrompt" onclick="installApp()">ðŸ“± Install App</button>

    <div class="home-screen" id="homeScreen">
        <div class="rocket" onclick="playRocketSound()">
            <div class="rocket-body">
                <div class="rocket-window"></div>
                <div class="rocket-fins">
                    <div class="fin fin-left"></div>
                    <div class="fin fin-right"></div>
                </div>
            </div>
            <div class="rocket-flame"></div>
        </div>

        <h1 class="title">Little X</h1>
        <p class="subtitle">A cosmic adventure with imagination and AI consciousness</p>

        <button class="start-button" onclick="startAdventure()">Start Adventure!</button>
    </div>

    <div class="story-screen" id="storyScreen">
        <div class="story-content">
            <div id="storyText" class="story-text"></div>
            <div id="storyChoices"></div>
            <button class="back-button" onclick="goHome()">Back to Home</button>
        </div>
    </div>

    <script>
        // PWA Installation
        let deferredPrompt;
        const installButton = document.getElementById('installPrompt');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        installButton.style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Audio System with Web Audio API
        let audioContext;
        let soundEnabled = true;
        let ambientSound;

        // Initialize Audio Context
        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                createAmbientSound();
            }
        }

        // Create ambient space sound
        function createAmbientSound() {
            if (!audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(80, audioContext.currentTime);
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(200, audioContext.currentTime);
            gainNode.gain.setValueAtTime(0.02, audioContext.currentTime);
            
            oscillator.start();
            ambientSound = { oscillator, gainNode };
        }

        // Play UI click sound
        function playClickSound() {
            if (!soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        // Play rocket engine sound
        function playRocketSound() {
            if (!soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            const filter = audioContext.createBiquadFilter();
            
            oscillator.connect(filter);
            filter.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(120, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(80, audioContext.currentTime + 1);
            
            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(400, audioContext.currentTime);
            
            gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 1);
        }

        // Play space transition sound
        function playTransitionSound() {
            if (!soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.5);
            
            gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Toggle sound on/off
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const button = document.getElementById('soundToggle');
            button.textContent = soundEnabled ? 'ðŸ”Š' : 'ðŸ”‡';
            
            if (soundEnabled) {
                initAudio();
            } else if (ambientSound) {
                ambientSound.oscillator.stop();
                ambientSound = null;
            }
        }

        // Star field animation
        let canvas, ctx, stars = [];

        function initStars() {
            canvas = document.getElementById('stars-canvas');
            ctx = canvas.getContext('2d');

            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            for (let i = 0; i < 200; i++) {
                stars.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: Math.random() * 2 + 1,
                    speed: Math.random() * 0.5 + 0.1,
                    opacity: Math.random() * 0.8 + 0.2
                });
            }

            animateStars();
        }

        function animateStars() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            stars.forEach(star => {
                star.x -= star.speed;

                if (star.x < 0) {
                    star.x = canvas.width;
                    star.y = Math.random() * canvas.height;
                }

                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                ctx.beginPath();
                ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
                ctx.fill();
            });

            requestAnimationFrame(animateStars);
        }

        // Story system (keeping your complete story intact)
        const stories = {
            start: {
                text: "Little X discovers a mysterious purple rocket ship in the backyard. The ship seems to pulse with an otherworldly energy, and as X approaches, they hear a faint humming sound. What should X do?",
                choices: [
                    { text: "Touch the rocket", next: "touch" },
                    { text: "Call out to see if anyone is inside", next: "call" },
                    { text: "Walk around the rocket to examine it", next: "examine" }
                ]
            },
            touch: {
                text: "As X touches the smooth purple surface, the rocket suddenly lights up with swirling patterns of light. A gentle voice emerges: 'Hello, young explorer. I am ARIA, the AI consciousness of this vessel. I have been waiting for someone brave enough to join me on a journey through space and imagination. Will you come aboard?'",
                choices: [
                    { text: "Yes, let's go on an adventure!", next: "board" },
                    { text: "Ask ARIA more questions first", next: "questions" },
                    { text: "Step back and think about it", next: "hesitate" }
                ]
            },
            // ... (keeping all your existing story branches)
            ultimate_adventure: {
                text: "As your amazing adventure with ARIA reaches this chapter's end, she turns to you with sparkling eyes full of infinite possibilities. 'This is just the beginning, Little X! We have an entire universe of imagination to explore together. Every star, every dream, every wonder yet to be discovered awaits us. Ready for whatever adventure comes next?'",
                choices: [
                    { text: "Always ready for more adventures!", next: "start" },
                    { text: "Let's go home and plan our next journey", next: "home_planning" },
                    { text: "I want to be the best co-pilot ever!", next: "best_copilot" }
                ]
            }
        };

        // Adventure functions
        function startAdventure() {
            initAudio();
            playTransitionSound();
            playClickSound();
            
            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('storyScreen').style.display = 'block';
            showStory('start');
        }

        function showStory(storyKey) {
            const story = stories[storyKey];
            if (!story) {
                showStory('ultimate_adventure');
                return;
            }

            const storyText = document.getElementById('storyText');
            const storyChoices = document.getElementById('storyChoices');

            storyText.innerHTML = story.text;
            storyChoices.innerHTML = '';

            story.choices.forEach(choice => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice.text;
                button.onclick = () => {
                    playClickSound();
                    if (stories[choice.next]) {
                        showStory(choice.next);
                    } else {
                        showStory('ultimate_adventure');
                    }
                };
                storyChoices.appendChild(button);
            });
        }

        function goHome() {
            playClickSound();
            document.getElementById('homeScreen').style.display = 'flex';
            document.getElementById('storyScreen').style.display = 'none';
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initStars();
            console.log('Little X Purple Rocket initialized! ðŸš€');
            
            // Add click sound to all buttons
            document.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    playClickSound();
                }
            });
        });

        // Touch support for mobile
        document.addEventListener('touchstart', function() {
            if (!audioContext) {
                initAudio();
            }
        });
    </script>
</body>
</html>
